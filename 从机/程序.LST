C51 COMPILER V8.02   程序                                                                  05/11/2022 21:09:45 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE 程序
OBJECT MODULE PLACED IN 程序.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE 程序.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg52.h>
   2          
   3          #define uint unsigned int
   4          #define uchar unsigned char
   5          #define slave_add       1
   6          
   7          sbit lcdrs=P2^6;
   8          sbit lcdrw=P2^5;
   9          sbit lcden=P2^7;
  10          sbit LED=P2^3;
  11          sbit ten=P3^2;
  12          
  13          
  14          #define TXEN ten=1; /*ren=1;*///发送使能
  15          #define RXEN ten=0; /*ren=0;*///接收使能
  16          
  17          uchar code table[5]="slave";
  18          
  19          uchar rbuf[4];          //接收数据缓存
  20          uchar receive_num=0;            //接收计数
  21          uchar time_js=0;
  22          
  23          void delayms(uint x)
  24          {
  25   1              uint i,j;
  26   1              for(i=x;i>0;i--)
  27   1                      for(j=110;j>0;j--);
  28   1      }
  29          /******************************
  30          1602液晶部分
  31          ******************************/
  32          void yjwrite_com(uchar com)
  33          {
  34   1              lcdrs=0;
  35   1              P0=com;
  36   1              delayms(5);
  37   1              lcden=1;
  38   1              delayms(5);
  39   1              lcden=0;
  40   1      }
  41          void yjwrite_date(uchar date)
  42          {
  43   1              lcdrs=1;
  44   1              P0=date;
  45   1              delayms(5);
  46   1              lcden=1;
  47   1              delayms(5);
  48   1              lcden=0;
  49   1      }
  50          void yjinit()
  51          {
  52   1              lcdrw=0;
  53   1              lcden=0;
  54   1              yjwrite_com(0x38);              
  55   1              yjwrite_com(0x0c);
C51 COMPILER V8.02   程序                                                                  05/11/2022 21:09:45 PAGE 2   

  56   1              yjwrite_com(0x06);
  57   1              yjwrite_com(0x01);              //显示清0，指针清0
  58   1      }
  59          
  60          void rs485_init()
  61          {
  62   1              TMOD=0X20;
  63   1              TL1=0XFD;
  64   1              TH1=0XFD;
  65   1              PCON=0X00;              //方式3，波特率正常
  66   1              TR1=1;
  67   1      
  68   1              SM0=0;SM1=1;      //设置串口工作方式
  69   1              REN=1;
  70   1      
  71   1              EA=1;
  72   1              ES=1;           //允许串口中断
  73   1              RXEN;
  74   1      }
  75          void main()
  76          {
  77   1              rs485_init();
  78   1              yjinit();
  79   1              yjwrite_com(0x80);
  80   1              yjwrite_date('R');
  81   1              yjwrite_date(':');
  82   1              while(1)
  83   1              {
  84   2                      if(receive_num)
  85   2                      {
  86   3                              time_js++;
  87   3                              if(time_js>=10)
  88   3                              {       
  89   4                                      time_js=0;
  90   4                                      receive_num=0;
  91   4                                      if(rbuf[0]==slave_add)
  92   4                                      {
  93   5                                              LED=!LED;
  94   5                                              yjwrite_com(0x80+2);
  95   5                                              yjwrite_date('0'+rbuf[1]/100);
  96   5                                              yjwrite_date('0'+rbuf[1]/10%10);
  97   5                                              yjwrite_date('0'+rbuf[1]%10);
  98   5      
  99   5                                              TXEN;
 100   5                                              SBUF=slave_add;while(!TI);TI=0;
 101   5                                              SBUF=rbuf[1];while(!TI);TI=0;
 102   5                                              RXEN;
 103   5      
 104   5                                      }
 105   4      
 106   4                                      
 107   4                                      
 108   4                              }
 109   3                                              
 110   3                      }
 111   2                      delayms(1);
 112   2              
 113   2              }
 114   1              
 115   1      }
 116          void chuankou()interrupt 4
 117          {
C51 COMPILER V8.02   程序                                                                  05/11/2022 21:09:45 PAGE 3   

 118   1              if(RI==1)
 119   1              {
 120   2                      RI=0;
 121   2                      rbuf[receive_num]=SBUF;
 122   2                      receive_num++;
 123   2                      time_js=0;
 124   2              }
 125   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    261    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
